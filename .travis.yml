language: android
jdk: oraclejdk8
cache: false
sudo: true
android:
  components:
  - build-tools-26.0.2
  - build-tools-27.0.3
  - android-26
  - android-25
  - android-24
  - extra-android-m2repository
  - extra-android-support
script:
- cp -f ./build_var_config ./building/bk
- "./gradlew clean"
- "./gradlew assembleRelease"
- cp x-apm-app/build/outputs/apk/release/x-apm-app-release.apk x-apm-app/x-apm-app-release-default.apk
- cp -f ./building/build_var_config_stable_play ./build_var_config
- "./gradlew clean"
- "./gradlew assembleRelease"
- cp x-apm-app/build/outputs/apk/release/x-apm-app-release.apk x-apm-app/x-apm-app-release-stable-play.apk
- cp -f ./building/build_var_config_aio ./build_var_config
- "./gradlew clean"
- "./gradlew assembleRelease"
- cp x-apm-app/build/outputs/apk/release/x-apm-app-release.apk x-apm-app/x-apm-app-release-aio.apk
- cp -f ./building/bk ./build_var_config
- git checkout build_var_config
before_script:
- mkdir -p "$ANDROID_HOME/licenses"
- cp ./building/android-sdk-license "$ANDROID_HOME/licenses/"
- cp ./building/hiddenapi/26/android.jar "$ANDROID_HOME/platforms/android-26/"
- cp ./building/hiddenapi/25/android.jar "$ANDROID_HOME/platforms/android-25/"
after_script:
- rm -rf ./app/google-services.json
notifications:
  email:
    recipients:
    - tornaco@163.com
    on_success: always
    on_failure: always
before_install:
- openssl aes-256-cbc -K $encrypted_9386c2da478c_key -iv $encrypted_9386c2da478c_iv
  -in building/keys_android.jks.enc -out building/keys/keys_android.jks -d
deploy:
  provider: releases
  api_key:
    secure: QGGIdCX9U+piuLrgHk7KhC3gIKJg7JeqocLWKw5g0lfdbcNjEUWO/mDSs8ucqk27WIoD/Nj0uzRGFq6P68WIpehpwEjoCild4bfTFhQomGG/kJ1GnvlPFG0K13qB0Ll3PXrRt661OAQcnpbiGzwoaiJOe+BozOCcmuJQxvCbATj8VQ88uZeCE4w+Ap/4FraCMb8qifeme2QjFZoXzh6zHelT13IB23+HQRCGczbalgmhUXo+rk8aCd+WE8MzDny9mOMizcMXG78kdhYzSJfW9B2WwFg6iKSkxPdkRvQedLr+sVA4katRhnUr5uJ1hOBnjB0KxPjUu44DEWaVBjqCzXAJh/z5CLLwmhi4qoKbc60LReiwCwgRuUNqeIYyIWO4fCwEY1SahL03jNjVQm9DI9mPGsUzwKY088hFqe5im79PCdWQETvnxGtSFWhqmztd1WwlAJZBc8zXbK99vf3DTa0yI3OU9XaIN8cgTIckWtavC3yY0Yuj2HIvGWaU4emE0LoNVSsQCUg/78rmy9GeKGtnHQJY5/LJC1xogP3IxQyiVDDU+HgE/8Be1l8ZtNw0/8DiFRCMckYrotpvtoG6ATzmVf+VLqGMs3EYG6a52LL5tPFWUl8HF2Ng2St/M6nk9C8hStyKpdhyJsLWX5sA25UzOg1itXIvyc90gAUnGtY=
  file:
  - x-apm-app/x-apm-app-release-default.apk
  - x-apm-app/x-apm-app-release-stable-play.apk
  - x-apm-app/x-apm-app-release-aio.apk
  skip_cleanup: true
  on:
    repo: Tornaco/X-APM
    tags: true
    all_branches: true
